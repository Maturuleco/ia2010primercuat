import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.LinkedList;
import java.util.List;


public class ParserComments {
	
	private static SimpleDateFormat formatter = new SimpleDateFormat("dd-MM-yyyy");
    
	public static List<Comment> generateComment(File restoComment) throws Exception{
		
		List<Comment> result = new LinkedList<Comment>();
		BufferedReader buffer = new BufferedReader( new FileReader( restoComment ) );
		String line = buffer.readLine(); // consumo la primer línea que no tiene nada
		
		String resto = restoComment.getName();
		String 	serviceRank = null;
		String 	foodRank = null;
		String 	environmentRank = null;
		Date 	date = null;
		String 	user = null;
		String 	text = null;
		
		
		while ( (line = buffer.readLine())!=null) {
			
			serviceRank = line.split("\\:")[1].trim();
			
			line = buffer.readLine();
			foodRank = line.split("\\:")[1].trim();
			
			line = buffer.readLine();
			String commentText = line.substring(10);
			text = replaceC(commentText); // je acento en ingles?
			
			
			line = buffer.readLine();
			date = formatter.parse(line.split("\\:")[1]);
			
			line = buffer.readLine();
			user = line.split("/")[4]; // ej. user: http://mi.guiaoleo.com/members/17248
			
			line = buffer.readLine();
			environmentRank = line.split("\\:")[1].trim();
			
			
			result.add(new Comment(resto,serviceRank,foodRank,environmentRank,date,user,text));
		}
	    
	    return result;
	}

	private static String replaceAccent(String text) {
		String result = text.replaceAll("\\\\xF3", "o");
		result = result.replaceAll("\\\\xE9", "e");
		result = result.replaceAll("\\\\xE1", "a");
		result = result.replaceAll("\\\\xED", "i");
		result = result.replaceAll("\\\\xFA", "u");
		return result;
	}
}
